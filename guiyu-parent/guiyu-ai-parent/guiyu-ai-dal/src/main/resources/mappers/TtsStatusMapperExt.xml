<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.guiji.ai.dao.TtsStatusMapperExt">

	<select id="getReqStatusByBusId">
		SELECT status FROM tts_status
		WHERE bus_id = #{busId,jdbcType=VARCHAR}
	</select>

	<update id="updateStatusByBusId">
		UPDATE tts_status
		SET status = #{status,jdbcType=INTEGER}
		WHERE bus_id = #{busId,jdbcType=VARCHAR}
	</update>
	
	<update id="updateJumpFlagByBusId">
		UPDATE tts_status
		SET jump_flag = 1
		WHERE bus_id = #{busId,jdbcType=VARCHAR}
	</update>
	
	<select id="getWaitTasks" resultType="java.util.Map">
		SELECT model, count(id) countNum 
		FROM tts_status 
		WHERE `status` = '0' 
		GROUP BY model
	</select>

    <select id="getTasksByDays" resultType="java.util.Map">
        SELECT count(id) countNum, sum(case when status='2' then 1 else 0 end) as countCompleteNum,DATE_FORMAT(create_time,'%Y-%m-%d') date
        FROM tts_status
        <where>
            <if test="startTime != null">
                create_time <![CDATA[>=]]> #{startTime,jdbcType=TIMESTAMP}
            </if>
            <if test="endTime != null">
                AND create_time <![CDATA[<=]]> #{endTime,jdbcType=TIMESTAMP}
            </if>
        </where>
        GROUP BY date
        ORDER BY date
    </select>

    <select id="getTasksByMonths" resultType="java.util.Map">
        SELECT count(id) countNum, sum(case when status='2' then 1 else 0 end) as countCompleteNum,DATE_FORMAT(create_time,'%Y-%m') date
        FROM tts_status
        <where>
            <if test="startTime != null">
                create_time <![CDATA[>=]]> #{startTime,jdbcType=TIMESTAMP}
            </if>
            <if test="endTime != null">
                AND create_time <![CDATA[<=]]> #{endTime,jdbcType=TIMESTAMP}
            </if>
        </where>
        GROUP BY date
        ORDER BY date
    </select>

</mapper>